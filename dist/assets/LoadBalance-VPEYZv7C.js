import{s as p,u as $,r as o,j as e}from"./index-Dwj1YBkb.js";import{M as k}from"./ModalContainer-eIZwfhKH.js";import{i as O,c as D}from"./stripe-DeB7fvVc.js";async function T(s,x,f,a){if(!s)throw new Error("[SEC_ERROR]: ID de usuario no proporcionado.");try{const{data:r,error:m}=await p.from("credit_packs").select("credits, price_usd, name").eq("code",x).single();if(m||!r)throw new Error(`[SEC_ERROR]: El paquete ${x} no es un nodo vÃ¡lido en el sistema.`);const{error:n}=await p.from("credit_transactions").insert({user_id:s,pack_code:x,credits_delta:r.credits,amount_usd:r.price_usd,payment_method:f,status:"success",external_ref:a,metadata:{processed_at:new Date().toISOString(),source:"adal_core_v3_secure_helper",pack_name:r.name}});if(n)throw new Error(`[DB_ERROR]: Fallo al registrar la transacciÃ³n en el ledger: ${n.message}`);const{data:u,error:c}=await p.from("profiles").select("credits").eq("id",s).single();if(c)throw new Error(`[DB_ERROR]: No se pudo recuperar el perfil del nodo ${s} para inyecciÃ³n.`);const i=((u==null?void 0:u.credits)||0)+r.credits,{error:b}=await p.from("profiles").update({credits:i}).eq("id",s);if(b)throw new Error(`[DB_ERROR]: Error al inyectar crÃ©ditos en el perfil: ${b.message}`);return console.log(`[CORE_SYNC] SincronizaciÃ³n exitosa: +${r.credits} CR inyectados en nodo ${s}. Ref: ${a}`),{success:!0,newBalance:i}}catch(r){return console.error("[CREDITS_CORE_FATAL]:",r.message),{success:!1,error:r.message||"Error desconocido en el nÃºcleo de crÃ©ditos."}}}async function I(s,x,f,a){if(!s)return{success:!1,error:"SesiÃ³n de usuario no vÃ¡lida."};try{if(f==="card"&&a)return await T(s,x,f,a);const{data:r}=await p.from("credit_packs").select("credits, price_usd").eq("code",x).single();if(!r)throw new Error("Nodo de paquete no encontrado en el sistema.");const{error:m}=await p.from("credit_transactions").insert({user_id:s,pack_code:x,credits_delta:r.credits,amount_usd:r.price_usd,payment_method:f,status:"pending",external_ref:a||`REQ_${Date.now()}`});if(m)throw m;return{success:!0}}catch(r){return console.error("[Credits] Initiation Failure:",r),{success:!1,error:r.message||"Error en el nÃºcleo de crÃ©ditos."}}}const L=({onClose:s})=>{const{user:x,refreshProfile:f,session:a}=$(),[r,m]=o.useState(null),[n,u]=o.useState(!1),[c,h]=o.useState(null),[i,b]=o.useState(!1),[_,E]=o.useState(!1),[g,j]=o.useState(null),[N,C]=o.useState([]),[S,R]=o.useState(!0),[w,v]=o.useState(null);o.useEffect(()=>{(async()=>{try{const{data:d}=await p.from("credit_packs").select("*").order("price_usd",{ascending:!0});d&&C(d)}finally{setTimeout(()=>R(!1),500)}})()},[]);const l=N.find(t=>t.code===r),A=async()=>{var t,d;if(!(!r||!c||!i||!((t=a==null?void 0:a.user)!=null&&t.id)||!l)){u(!0),j(null);try{c==="card"?await O({userId:a.user.id,userEmail:a.user.email||"",items:[{id:l.code,type:"credit_pack",quantity:1,name:l.name,price:l.price_usd}]}):c==="crypto"?await D({userId:a.user.id,amount:l.price_usd,orderId:l.code,orderDescription:`Recarga ${l.credits} CR`,category:"credits"}):(await I(a.user.id,r,c,`TOPUP_${Date.now()}`),E(!0))}catch(P){j(((d=P.message)==null?void 0:d.toUpperCase())||"ERROR EN LA TRANSACCIÃ“N"),u(!1)}}},y=(t,d)=>{navigator.clipboard.writeText(t.replace(/\s/g,"")),v(d),setTimeout(()=>v(null),2e3)};return _?e.jsx(k,{title:"OperaciÃ³n Registrada",onClose:s,children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center animate-in zoom-in",children:[e.jsx("div",{className:"w-20 h-20 bg-[#00ff88]/10 border-2 border-[#00ff88] rounded-full flex items-center justify-center text-4xl mb-6 shadow-[0_0_20px_#00ff8844]",children:"âœ“"}),e.jsx("h3",{className:"text-xl font-orbitron font-bold text-white uppercase mb-2",children:"SeÃ±al Recibida"}),e.jsx("p",{className:"text-xs text-gray-500 font-mono mb-8 uppercase",children:"EnvÃ­a tu comprobante a ap@adalparedes.com para validar la inyecciÃ³n de crÃ©ditos."}),e.jsx("button",{onClick:s,className:"px-10 py-4 bg-[#00ff88] text-black font-bold rounded-xl uppercase font-orbitron hover:scale-105 transition-all",children:"Finalizar Protocolo"})]})}):e.jsx(k,{title:"CARGA DE CRÃ‰DITOS",onClose:s,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-10",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-[#00d2ff] rounded-full animate-pulse"}),e.jsx("h3",{className:"text-[10px] font-mono text-gray-500 tracking-widest uppercase font-bold",children:"1. Seleccionar Paquete de Datos"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 relative min-h-[120px]",children:S?Array.from({length:4}).map((t,d)=>e.jsx("div",{className:"h-32 bg-white/5 border border-white/5 rounded-[2rem] animate-pulse"},d)):N.map(t=>e.jsxs("button",{disabled:n,onClick:()=>m(t.code),className:`group border rounded-[2rem] p-6 text-center transition-all ${r===t.code?"bg-[#00d2ff]/10 border-[#00d2ff] scale-105 shadow-[0_0_25px_rgba(0,210,255,0.2)]":"bg-black/20 border-white/5 hover:border-white/20"} ${n?"opacity-50 grayscale":""}`,children:[e.jsx("div",{className:`text-[9px] font-orbitron font-bold mb-1 uppercase tracking-widest ${r===t.code?"text-[#00d2ff]":"text-gray-500"}`,children:t.name}),e.jsxs("div",{className:"text-2xl font-orbitron font-bold text-white tracking-tighter mb-1",children:["$",t.price_usd]}),e.jsxs("div",{className:"text-[10px] font-mono text-[#00ff88] font-bold",children:["+",t.credits," CRED"]})]},t.code))}),e.jsxs("div",{className:"p-6 bg-black/40 border border-white/10 rounded-[2rem] flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-mono text-gray-500 uppercase tracking-widest",children:"Orden actual:"}),e.jsx("span",{className:"text-2xl font-orbitron font-bold text-white tracking-tighter",children:l?`$${l.price_usd}`:"$0.00"})]}),e.jsxs("div",{className:"p-5 bg-red-500/5 border border-red-500/20 rounded-2xl flex gap-4 items-start relative overflow-hidden group",children:[e.jsx("div",{className:"text-2xl animate-pulse shrink-0",children:"âš ï¸"}),e.jsxs("div",{className:"flex flex-col gap-1 z-10",children:[e.jsx("span",{className:"text-[10px] font-bold text-red-500 uppercase tracking-widest",children:"Aviso para Clientes USA / Internacional:"}),e.jsxs("p",{className:"text-[10px] text-gray-300 font-mono leading-relaxed uppercase italic",children:["Se recomienda pagar con ",e.jsx("span",{className:"text-white font-bold",children:"Tarjeta o Cripto"}),". Las transferencias internacionales (Wire/ACH) pueden tardar de 1 a 3 dÃ­as hÃ¡biles en reflejarse."]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-[#00ff88] rounded-full animate-pulse"}),e.jsx("h3",{className:"text-[10px] font-mono text-gray-500 tracking-widest uppercase font-bold",children:"2. Pasarela de Pago Seguro"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{disabled:n,onClick:()=>h("card"),className:`w-full p-4 border rounded-2xl text-left transition-all flex items-center justify-between group ${c==="card"?"border-[#00d2ff] bg-[#00d2ff]/10":"border-white/5 bg-black/40 hover:border-white/20"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’³"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[11px] font-bold text-white uppercase tracking-tight",children:"Tarjeta CrÃ©dito / DÃ©bito"}),e.jsx("span",{className:"text-[8px] text-gray-500 font-mono uppercase tracking-tighter",children:"VÃ­a Stripe SSL / 256-bit Encryption"})]})]})}),e.jsx("button",{disabled:n,onClick:()=>h("crypto"),className:`w-full p-4 border rounded-2xl text-left transition-all flex items-center justify-between group ${c==="crypto"?"border-[#f7931a] bg-[#f7931a]/10":"border-white/5 bg-black/40 hover:border-white/20"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-2xl",children:"â‚¿"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-[11px] font-bold text-white uppercase tracking-tight",children:["Criptomonedas (Blockchain) ",e.jsx("span",{className:"text-[8px] bg-[#f7931a] text-black px-1.5 py-0.5 rounded font-bold animate-pulse",children:"-15% REWARD"})]}),e.jsx("span",{className:"text-[8px] text-gray-500 font-mono uppercase",children:"NOWPayments / TransacciÃ³n AnÃ³nima"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{disabled:n,onClick:()=>h("bank_usa"),className:`w-full p-4 border rounded-2xl text-left transition-all flex items-center justify-between group ${c==="bank_usa"?"border-[#00d2ff] bg-[#00d2ff]/10":"border-white/5 bg-black/40 hover:border-white/20"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ¦"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[11px] font-bold text-white uppercase tracking-tight",children:"USD USA Wire / ACH"}),e.jsx("span",{className:"text-[8px] text-gray-500 font-mono uppercase",children:"Lead Bank Protocol"})]})]})}),c==="bank_usa"&&e.jsxs("div",{className:"p-5 bg-black/60 border border-[#00d2ff]/30 rounded-2xl space-y-3 animate-in slide-in-from-top-2",children:[[{l:"Titular",v:"Adalberto Paredes Gutierrez"},{l:"Banco",v:"Lead Bank"},{l:"Cuenta",v:"214595020057"},{l:"ACH",v:"101019644"}].map(t=>e.jsxs("div",{className:"flex flex-col text-[10px] font-mono",children:[e.jsxs("span",{className:"text-gray-500 uppercase text-[8px]",children:[t.l,":"]}),e.jsx("button",{onClick:()=>y(t.v,t.l),className:"text-white hover:text-[#00d2ff] font-bold text-left",children:w===t.l?"COPIADO":t.v})]},t.l)),e.jsx("p",{className:"text-[8px] text-[#00ff88] font-bold uppercase pt-2 border-t border-white/10",children:"EnvÃ­o de comprobante: ap@adalparedes.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{disabled:n,onClick:()=>h("bank_mxn"),className:`w-full p-4 border rounded-2xl text-left transition-all flex items-center justify-between group ${c==="bank_mxn"?"border-[#00ff88] bg-[#00ff88]/10":"border-white/5 bg-black/40 hover:border-white/20"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-xl font-bold text-white",children:"MX"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[11px] font-bold text-white uppercase tracking-tight",children:"SPEI MÃ©xico (MXN)"}),e.jsx("span",{className:"text-[8px] text-gray-500 font-mono uppercase",children:"NU Bank SincronizaciÃ³n"})]})]})}),c==="bank_mxn"&&e.jsxs("div",{className:"p-5 bg-black/60 border border-[#00ff88]/30 rounded-2xl space-y-3 animate-in slide-in-from-top-2",children:[[{l:"Beneficiario",v:"Adalberto Paredes Gutierrez"},{l:"CLABE",v:"6381 8000 0113 7662 19"},{l:"Banco",v:"NU MÃ‰XICO"}].map(t=>e.jsxs("div",{className:"flex flex-col text-[10px] font-mono",children:[e.jsxs("span",{className:"text-gray-500 uppercase text-[8px]",children:[t.l,":"]}),e.jsx("button",{onClick:()=>y(t.v,t.l),className:"text-white hover:text-[#00ff88] font-bold text-left",children:w===t.l?"COPIADO":t.v})]},t.l)),e.jsx("p",{className:"text-[8px] text-[#00ff88] font-bold uppercase pt-2 border-t border-white/10",children:"EnvÃ­o de comprobante: ap@adalparedes.com"})]})]})]}),e.jsxs("div",{className:"pt-4 space-y-4",children:[g&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 text-red-500 text-[9px] font-mono uppercase rounded text-center animate-shake",children:g}),e.jsxs("div",{className:"flex items-start gap-3 cursor-pointer group",onClick:()=>b(!i),children:[e.jsx("div",{className:`mt-0.5 w-4 h-4 rounded border flex items-center justify-center transition-all ${i?"bg-[#00ff88] border-[#00ff88]":"border-white/20 bg-black group-hover:border-[#00ff88]/50"}`,children:i&&e.jsx("span",{className:"text-black text-[10px] font-bold",children:"âœ“"})}),e.jsx("span",{className:"text-[9px] text-gray-500 uppercase font-mono leading-tight select-none",children:"Acepto los protocolos de seguridad y tiempos de sincronizaciÃ³n bancaria."})]}),e.jsx("button",{disabled:!r||!c||!i||n,onClick:A,className:`w-full py-5 font-orbitron font-bold text-xs rounded-2xl uppercase transition-all tracking-[0.2em] shadow-xl flex items-center justify-center gap-3 ${!r||!c||!i||n?"bg-gray-800 text-gray-600":"bg-[#00ff88] text-black hover:bg-white shadow-[0_0_30px_rgba(0,255,136,0.4)]"}`,children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-black border-t-transparent rounded-full animate-spin"}),"Sincronizando..."]}):"CONFIRMAR CARGA"}),e.jsx("p",{className:"text-[7px] text-gray-500 font-mono uppercase tracking-[0.3em] text-center opacity-40",children:"AES-256 BIT ENCRYPTION ACTIVE"})]})]})]})})};export{L as default};
