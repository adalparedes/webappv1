import{s as u,a as O,r as i,j as e}from"./index-Bf9kFFtr.js";import{M as k}from"./ModalContainer-DqPdIIW-.js";import{i as T,c as B}from"./stripe-CeGn_1Vp.js";async function L(s,l,b,p){if(!s)throw new Error("[SEC_ERROR]: ID de usuario no proporcionado.");try{const{data:r,error:o}=await u.from("credit_packs").select("credits, price_usd, name").ilike("code",l).single();if(o||!r)throw new Error(`[SEC_ERROR]: El paquete ${l} no es un nodo v√°lido en el sistema.`);const{error:f}=await u.from("credit_transactions").insert({user_id:s,pack_code:l,credits_delta:r.credits,amount_usd:r.price_usd,payment_method:b,status:"success",external_ref:p,metadata:{processed_at:new Date().toISOString(),source:"adal_core_v3_secure_helper",pack_name:r.name}});if(f)throw new Error(`[DB_ERROR]: Fallo al registrar la transacci√≥n en el ledger: ${f.message}`);const{data:a,error:g}=await u.from("profiles").select("credits").eq("id",s).single();if(g)throw new Error(`[DB_ERROR]: No se pudo recuperar el perfil del nodo ${s} para inyecci√≥n.`);const m=((a==null?void 0:a.credits)||0)+r.credits,{error:d}=await u.from("profiles").update({credits:m}).eq("id",s);if(d)throw new Error(`[DB_ERROR]: Error al inyectar cr√©ditos en el perfil: ${d.message}`);return console.log(`[CORE_SYNC] Sincronizaci√≥n exitosa: +${r.credits} CR inyectados en nodo ${s}. Ref: ${p}`),{success:!0,newBalance:m}}catch(r){return console.error("[CREDITS_CORE_FATAL]:",r.message),{success:!1,error:r.message||"Error desconocido en el n√∫cleo de cr√©ditos."}}}async function F(s,l,b,p){if(!s)return{success:!1,error:"Sesi√≥n de usuario no v√°lida."};try{if(b==="card"&&p)return await L(s,l,b,p);const{data:r,error:o}=await u.from("credit_packs").select("credits, price_usd").ilike("code",l).single();if(o||!r)throw new Error("Nodo de paquete no encontrado en el sistema.");const{error:f}=await u.from("credit_transactions").insert({user_id:s,pack_code:l,credits_delta:r.credits,amount_usd:r.price_usd,payment_method:b,status:"pending",external_ref:p||`REQ_${Date.now()}`});if(f)throw f;return{success:!0}}catch(r){return console.error("[Credits] Initiation Failure:",r),{success:!1,error:r.message||"Error en el n√∫cleo de cr√©ditos."}}}const z=({onClose:s,onOpenModal:l})=>{const{user:b,refreshProfile:p,session:r}=O(),[o,f]=i.useState(null),[a,g]=i.useState(!1),[c,m]=i.useState(null),[d,E]=i.useState(!1),[S,C]=i.useState(!1),[j,N]=i.useState(null),[w,R]=i.useState([]),[P,$]=i.useState(!0),[y,v]=i.useState(null);i.useEffect(()=>{(async()=>{try{const{data:n}=await u.from("credit_packs").select("*").eq("is_active",!0).order("price_usd",{ascending:!0});n&&R(n)}finally{setTimeout(()=>$(!1),500)}})()},[]);const x=w.find(t=>t.code===o),A=async()=>{var t,n;if(!(!o||!c||!d||!((t=r==null?void 0:r.user)!=null&&t.id)||!x)){g(!0),N(null);try{c==="card"?await T({userId:r.user.id,userEmail:r.user.email||"",items:[{id:x.code,type:"credit_pack",quantity:1,name:x.name,price:x.price_usd}]}):c==="crypto"?await B({userId:r.user.id,amount:x.price_usd,orderId:x.code,orderDescription:`Recarga ${x.credits} CR`,category:"credits"}):(await F(r.user.id,o,c,`TOPUP_${Date.now()}`),C(!0))}catch(h){N(((n=h.message)==null?void 0:n.toUpperCase())||"ERROR EN LA TRANSACCI√ìN"),g(!1)}}},_=(t,n)=>{navigator.clipboard.writeText(t.replace(/\s/g,"")),v(n),setTimeout(()=>v(null),2e3)};if(S)return e.jsx(k,{title:"Operaci√≥n Registrada",onClose:s,children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center animate-in zoom-in",children:[e.jsx("div",{className:"w-20 h-20 bg-[#00ff88]/10 border-2 border-[#00ff88] rounded-full flex items-center justify-center text-4xl mb-6 shadow-[0_0_20px_#00ff8844]",children:"‚úì"}),e.jsx("h3",{className:"text-xl font-orbitron font-bold text-white uppercase mb-2",children:"Se√±al Recibida"}),e.jsx("p",{className:"text-xs text-gray-500 font-mono mb-8 uppercase",children:"Env√≠a tu comprobante a ap@adalparedes.com para validar la inyecci√≥n de cr√©ditos."}),e.jsx("button",{onClick:s,className:"px-10 py-4 bg-[#00ff88] text-black font-bold rounded-xl uppercase font-orbitron hover:scale-105 transition-all",children:"Finalizar Protocolo"})]})});const D=t=>{switch(t.toLowerCase()){case"mini_boost":return{selected:"bg-[rgba(249,115,22,0.1)] border-[#f97316] shadow-[0_0_25px_rgba(249,115,22,0.3)]",text:"text-[#f97316]",hover:"hover:border-[#f97316]"};case"carga_media":return{selected:"bg-[rgba(34,197,94,0.1)] border-[#22c55e] shadow-[0_0_25px_rgba(34,197,94,0.3)]",text:"text-[#22c55e]",hover:"hover:border-[#22c55e]"};case"pro_boost":return{selected:"bg-[rgba(168,85,247,0.1)] border-[#a855f7] shadow-[0_0_25px_rgba(168,85,247,0.3)]",text:"text-[#a855f7]",hover:"hover:border-[#a855f7]"};case"legend_boost":return{selected:"bg-[rgba(245,158,11,0.1)] border-[#f59e0b] shadow-[0_0_25px_rgba(245,158,11,0.3)]",text:"text-[#f59e0b]",hover:"hover:border-[#f59e0b]"};default:return{selected:"bg-[#00d2ff]/10 border-[#00d2ff] shadow-[0_0_25px_rgba(0,210,255,0.2)]",text:"text-[#00d2ff]",hover:"hover:border-white/20"}}};return e.jsx(k,{title:"CARGA DE CR√âDITOS",onClose:s,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-10",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-[#00d2ff] rounded-full animate-pulse"}),e.jsx("h3",{className:"text-[10px] font-mono text-gray-300 tracking-widest uppercase font-bold",children:"1. Seleccionar Paquete de Datos"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 relative min-h-[120px]",children:P?Array.from({length:4}).map((t,n)=>e.jsx("div",{className:"h-32 bg-white/5 border border-white/5 rounded-[2rem] animate-pulse"},n)):w.map(t=>{const n=o===t.code,h=D(t.code);return e.jsxs("button",{disabled:a,onClick:()=>f(t.code),className:`group border rounded-[2rem] p-6 text-center transition-all ${n?`${h.selected} scale-105`:`bg-black/20 border-white/5 ${h.hover}`} ${a?"opacity-50 grayscale":""}`,children:[e.jsx("div",{className:`text-[9px] font-orbitron font-bold mb-1 uppercase tracking-widest ${n?h.text:"text-gray-300"}`,children:t.name}),e.jsxs("div",{className:"text-2xl font-orbitron font-bold text-white tracking-tighter mb-1",children:["$",t.price_usd]}),e.jsxs("div",{className:"text-[10px] font-mono text-[#00ff88] font-bold",children:["+",t.credits," CRED"]})]},t.code)})}),e.jsxs("div",{className:"p-6 bg-black/40 border border-white/10 rounded-[2rem] flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-mono text-gray-400 uppercase tracking-widest",children:"Orden actual:"}),e.jsx("span",{className:"text-2xl font-orbitron font-bold text-white tracking-tighter",children:x?`$${x.price_usd}`:"$0.00"})]}),e.jsxs("div",{className:"p-5 bg-red-500/5 border border-red-500/20 rounded-2xl flex gap-4 items-start relative overflow-hidden group",children:[e.jsx("div",{className:"text-2xl animate-pulse shrink-0",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"flex flex-col gap-1 z-10",children:[e.jsx("span",{className:"text-[10px] font-bold text-red-500 uppercase tracking-widest",children:"Aviso para Clientes USA / Internacional:"}),e.jsxs("p",{className:"text-[10px] text-gray-300 font-mono leading-relaxed uppercase italic",children:["Se recomienda pagar con ",e.jsx("span",{className:"text-white font-bold",children:"Tarjeta o Cripto"}),". Las transferencias internacionales (Wire/ACH) pueden tardar de 1 a 3 d√≠as h√°biles en reflejarse."]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-[#00ff88] rounded-full animate-pulse"}),e.jsx("h3",{className:"text-[10px] font-mono text-gray-300 tracking-widest uppercase font-bold",children:"2. Pasarela de Pago Seguro"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{disabled:a,onClick:()=>m("card"),className:`w-full p-4 border rounded-2xl text-left transition-all flex items-center justify-between group ${c==="card"?"border-[#00d2ff] bg-[#00d2ff]/10":"border-white/5 bg-black/40 hover:border-white/20"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-2xl",children:"üí≥"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[11px] font-bold text-white uppercase tracking-tight",children:"Tarjeta Cr√©dito / D√©bito"}),e.jsx("span",{className:"text-[8px] text-gray-500 font-mono uppercase tracking-tighter",children:"V√≠a Stripe SSL / 256-bit Encryption"})]})]})}),e.jsx("button",{disabled:a,onClick:()=>m("crypto"),className:`w-full p-4 border rounded-2xl text-left transition-all flex items-center justify-between group ${c==="crypto"?"border-[#f7931a] bg-[#f7931a]/10":"border-white/5 bg-black/40 hover:border-white/20"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-2xl",children:"‚Çø"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-[11px] font-bold text-white uppercase tracking-tight",children:["Bitcoin - Crypto ",e.jsx("span",{className:"text-[8px] bg-[#f7931a] text-black px-1.5 py-0.5 rounded font-bold animate-pulse",children:"15% DE DESCUENTO"})]}),e.jsx("span",{className:"text-[8px] text-gray-500 font-mono uppercase",children:"NOWPayments / Transacci√≥n An√≥nima"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{disabled:a,onClick:()=>m("bank_usa"),className:`w-full p-4 border rounded-2xl text-left transition-all flex items-center justify-between group ${c==="bank_usa"?"border-[#00d2ff] bg-[#00d2ff]/10":"border-white/5 bg-black/40 hover:border-white/20"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-2xl",children:"üè¶"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[11px] font-bold text-white uppercase tracking-tight",children:"USD USA Wire / ACH"}),e.jsx("span",{className:"text-[8px] text-gray-500 font-mono uppercase",children:"Lead Bank Protocol"})]})]})}),c==="bank_usa"&&e.jsxs("div",{className:"p-5 bg-black/60 border border-[#00d2ff]/30 rounded-2xl space-y-3 animate-in slide-in-from-top-2",children:[[{l:"Titular",v:"Adalberto Paredes Gutierrez",copy:!1},{l:"Banco",v:"Lead Bank",copy:!1},{l:"Cuenta",v:"214595020057",copy:!0},{l:"ACH",v:"101019644",copy:!0}].map(t=>e.jsxs("div",{className:"flex flex-col text-[10px] font-mono",children:[e.jsxs("span",{className:"text-gray-500 uppercase text-[8px]",children:[t.l,":"]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("span",{className:"text-white font-bold",children:t.v}),t.copy&&e.jsx("button",{onClick:()=>_(t.v,t.l),className:"text-gray-500 hover:text-[#00d2ff] transition-colors text-lg",title:`Copiar ${t.l}`,children:y===t.l?"‚úÖ":"üìã"})]})]},t.l)),e.jsx("p",{className:"text-[8px] text-[#00ff88] font-bold uppercase pt-2 border-t border-white/10",children:"Env√≠o de comprobante: ap@adalparedes.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{disabled:a,onClick:()=>m("bank_mxn"),className:`w-full p-4 border rounded-2xl text-left transition-all flex items-center justify-between group ${c==="bank_mxn"?"border-[#00ff88] bg-[#00ff88]/10":"border-white/5 bg-black/40 hover:border-white/20"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-xl font-bold text-white",children:"MX"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[11px] font-bold text-white uppercase tracking-tight",children:"SPEI M√©xico (MXN)"}),e.jsx("span",{className:"text-[8px] text-gray-500 font-mono uppercase",children:"NU Bank Sincronizaci√≥n"})]})]})}),c==="bank_mxn"&&e.jsxs("div",{className:"p-5 bg-black/60 border border-[#00ff88]/30 rounded-2xl space-y-3 animate-in slide-in-from-top-2",children:[[{l:"Beneficiario",v:"Adalberto Paredes Gutierrez",copy:!1},{l:"CLABE",v:"6381 8000 0113 7662 19",copy:!0},{l:"Banco",v:"NU M√âXICO",copy:!1}].map(t=>e.jsxs("div",{className:"flex flex-col text-[10px] font-mono",children:[e.jsxs("span",{className:"text-gray-500 uppercase text-[8px]",children:[t.l,":"]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("span",{className:"text-white font-bold",children:t.v}),t.copy&&e.jsx("button",{onClick:()=>_(t.v,t.l),className:"text-gray-500 hover:text-[#00ff88] transition-colors text-lg",title:`Copiar ${t.l}`,children:y===t.l?"‚úÖ":"üìã"})]})]},t.l)),e.jsx("p",{className:"text-[8px] text-[#00ff88] font-bold uppercase pt-2 border-t border-white/10",children:"Env√≠o de comprobante: ap@adalparedes.com"})]})]})]}),e.jsxs("div",{className:"pt-4 space-y-4",children:[j&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 text-red-500 text-[9px] font-mono uppercase rounded text-center animate-shake",children:j}),e.jsxs("div",{className:"flex items-start gap-3 cursor-pointer group",onClick:()=>E(!d),children:[e.jsx("div",{className:`mt-0.5 w-4 h-4 rounded border flex items-center justify-center transition-all ${d?"bg-[#00ff88] border-[#00ff88]":"border-white/20 bg-black group-hover:border-[#00ff88]/50"}`,children:d&&e.jsx("span",{className:"text-black text-[10px] font-bold",children:"‚úì"})}),e.jsxs("span",{className:"text-[9px] text-gray-300 uppercase font-mono leading-tight select-none",children:["Acepto los ",e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),l("terms")},className:"underline bg-transparent border-none p-0 m-0 align-baseline font-inherit text-white hover:text-[#00d2ff] cursor-pointer",children:"t√©rminos y condiciones"})]})]}),e.jsx("button",{disabled:!o||!c||!d||a,onClick:A,className:`w-full py-5 font-orbitron font-bold text-xs rounded-2xl uppercase transition-all tracking-[0.2em] shadow-xl flex items-center justify-center gap-3 ${!o||!c||!d||a?"bg-gray-800 text-gray-600":"bg-[#00ff88] text-black hover:bg-white shadow-[0_0_30px_rgba(0,255,136,0.4)]"}`,children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-black border-t-transparent rounded-full animate-spin"}),"Sincronizando..."]}):"CONFIRMAR CARGA"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-center",children:[e.jsx("span",{className:"text-sm text-[#00ff88]",children:"üõ°Ô∏è"}),e.jsxs("p",{className:"text-[8px] text-gray-400 font-mono uppercase tracking-widest",children:["Pasarela Segura ",e.jsx("span",{className:"font-bold text-white",children:"SSL"})," / Transacci√≥n Encriptada"]})]})]})]})]})})};export{z as default};
